<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D3 v3 Bar Chart Example</title>
  <script src="https://d3js.org/d3.v3.min.js"></script>
</head>
<body>

<script>
// Load the CSV data
d3.csv('shopping_behavior_updated.csv', function(error, dataset) {
  if (error) throw error;

  // Function to compute average purchase amount grouped by gender
  function computeAverageByGender(data) {
    const sums = {};
    const counts = {};

    // Iterate through the data to calculate sums and counts
    data.forEach(function(d) {
      const gender = d.Gender;
      const purchaseAmount = parseFloat(d['Purchase Amount (USD)']);

      sums[gender] = (sums[gender] || 0) + purchaseAmount;
      counts[gender] = (counts[gender] || 0) + 1;
    });

    // Calculate averages
    const averages = {};
    for (const gender in sums) {
      averages[gender] = sums[gender] / counts[gender];
    }

    return averages;
  }

  // Call the function and get the result
  const result = computeAverageByGender(dataset);

  // Create a bar chart
  const svgWidth = 300;
  const svgHeight = 200;

  const svg = d3.select('body').append('svg')
    .attr('width', svgWidth)
    .attr('height', svgHeight);

  const barWidth = 50;
  const barPadding = 10;

  const genders = Object.keys(result);
  const colorScale = d3.scale.category10();

  svg.selectAll('rect')
    .data(genders)
    .enter()
    .append('rect')
    .attr('x', (d, i) => i * (barWidth + barPadding))
    .attr('y', d => svgHeight - result[d] * 5) // Scale down for better visualization
    .attr('width', barWidth)
    .attr('height', d => result[d] * 5) // Scale up for better visualization
    .attr('fill', (d, i) => colorScale(i));

  svg.selectAll('text')
    .data(genders)
    .enter()
    .append('text')
    .text(d => result[d].toFixed(2)) // Show average with 2 decimal places
    .attr('x', (d, i) => i * (barWidth + barPadding) + barWidth / 2)
    .attr('y', d => svgHeight - result[d] * 5 - 5) // Adjust position for better alignment
    .attr('text-anchor', 'middle')
    .attr('font-size', '12px')
    .attr('fill', 'white');

});
</script>

</body>
</html>