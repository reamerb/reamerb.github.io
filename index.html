<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D3 v3 Bar Chart Example</title>
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    svg {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>

<script>
// Load the CSV data
d3.csv('shopping_behavior_updated.csv', function(error, dataset) {
  if (error) throw error;

  // Function to compute average purchase amount grouped by gender
  function computeAverageByGender(data) {
    const sums = {};
    const counts = {};

    // Iterate through the data to calculate sums and counts
    data.forEach(function(d) {
      const gender = d.Gender;
      const purchaseAmount = parseFloat(d['Purchase Amount (USD)']);

      sums[gender] = (sums[gender] || 0) + purchaseAmount;
      counts[gender] = (counts[gender] || 0) + 1;
    });

    // Calculate averages
    const averages = {};
    for (const gender in sums) {
      averages[gender] = sums[gender] / counts[gender];
    }

    return averages;
  }

  // Call the function and get the result
  const result = computeAverageByGender(dataset);

  // Set up the chart dimensions
  const svgWidth = 600; // Increased width by 50%
  const svgHeight = 600; // Maintained the same height
  const margin = { top: 20, right: 20, bottom: 50, left: 50 };
  const chartWidth = svgWidth - margin.left - margin.right;
  const chartHeight = svgHeight - margin.top - margin.bottom;

  // Create an SVG element
  const svg = d3.select('body').append('svg')
    .attr('width', svgWidth)
    .attr('height', svgHeight)
    .append('g')
    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

  // Create X and Y scales
  const xScale = d3.scale.ordinal()
    .domain(Object.keys(result))
    .rangeBands([0, chartWidth], 0.25);

  const yScale = d3.scale.linear()
    .domain([0, 70]) // Capped the Y-axis at 70
    .range([chartHeight, 0]);

  // Create X and Y axes
  const xAxis = d3.svg.axis()
    .scale(xScale)
    .orient('bottom');

  const yAxis = d3.svg.axis()
    .scale(yScale)
    .orient('left');

  // Draw X and Y axes
  svg.append('g')
    .attr('class', 'x axis')
    .attr('transform', 'translate(0,' + chartHeight + ')')
    .call(xAxis)
    .append('text') // Label for X-axis
      .attr('x', chartWidth / 2)
      .attr('y', margin.bottom - 5)
      .attr('dy', '1em')
      .style('text-anchor', 'middle')
      .text('Gender');

  svg.append('g')
    .attr('class', 'y axis')
    .call(yAxis);

  // Label the Y-axis
  svg.append('text')
    .attr('transform', 'rotate(-90)')
    .attr('y', 0 - margin.left - 5)
    .attr('x', 0 - chartHeight / 2)
    .attr('dy', '1em')
    .style('text-anchor', 'middle')
    .text('Purchase Amount (USD)');

  // Label for X-axis
  svg.select('.x.axis')
    .append('text')
    .attr('x', chartWidth / 2)
    .attr('y', margin.bottom - 5)
    .attr('dy', '1em')
    .style('text-anchor', 'middle')
    .text('Gender');

  // Create bars
  svg.selectAll('rect')
    .data(Object.keys(result))
    .enter()
    .append('rect')
    .attr('x', d => xScale(d) + xScale.rangeBand() / 4)
    .attr('y', d => yScale(result[d]))
    .attr('width', xScale.rangeBand() / 2)
    .attr('height', d => chartHeight - yScale(result[d]))
    .attr('fill', (d, i) => i === 1 ? '#FFA3D2' : '#0583D2'); // Change color of the second bar

  // Label the bars
  svg.selectAll('text')
    .data(Object.keys(result))
    .enter()
    .append('text')
    .text(d => d)
    .attr('x', d => xScale(d) + xScale.rangeBand() / 2)
    .attr('y', chartHeight + margin.bottom - 5)
    .attr('text-anchor', 'middle')
    .attr('font-size', '12px');
});
</script>

</body>
</html>
