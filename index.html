<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D3 v3 Bar Chart Example</title>
  <script src="https://d3js.org/d3.v3.min.js"></script>
</head>
<body>

<script>
// Load the CSV data
d3.csv('shopping_behavior_updated.csv', function(error, dataset) {
  if (error) throw error;

  // Function to compute average purchase amount grouped by gender
  function computeAverageByGender(data) {
    const sums = {};
    const counts = {};

    // Iterate through the data to calculate sums and counts
    data.forEach(function(d) {
      const gender = d.Gender;
      const purchaseAmount = parseFloat(d['Purchase Amount (USD)']);

      sums[gender] = (sums[gender] || 0) + purchaseAmount;
      counts[gender] = (counts[gender] || 0) + 1;
    });

    // Calculate averages
    const averages = {};
    for (const gender in sums) {
      averages[gender] = sums[gender] / counts[gender];
    }

    return averages;
  }

  // Call the function and get the result
  const result = computeAverageByGender(dataset);

  // Set up the chart dimensions
  const svgWidth = 400;
  const svgHeight = 300;
  const margin = { top: 20, right: 20, bottom: 30, left: 40 };
  const chartWidth = svgWidth - margin.left - margin.right;
  const chartHeight = svgHeight - margin.top - margin.bottom;

  // Create an SVG element
  const svg = d3.select('body').append('svg')
    .attr('width', svgWidth)
    .attr('height', svgHeight)
    .append('g')
    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

  // Create X and Y scales
  const xScale = d3.scale.ordinal()
    .domain(Object.keys(result))
    .rangeBands([0, chartWidth]);

  const yScale = d3.scale.linear()
    .domain([0, d3.max(Object.values(result))])
    .range([chartHeight, 0]);

  // Create X and Y axes
  const xAxis = d3.svg.axis()
    .scale(xScale)
    .orient('bottom');

  const yAxis = d3.svg.axis()
    .scale(yScale)
    .orient('left');

  // Draw X and Y axes
  svg.append('g')
    .attr('class', 'x axis')
    .attr('transform', 'translate(0,' + chartHeight + ')')
    .call(xAxis);

  svg.append('g')
    .attr('class', 'y axis')
    .call(yAxis);

  // Create bars
  svg.selectAll('rect')
    .data(Object.keys(result))
    .enter()
    .append('rect')
    .attr('x', d => xScale(d))
    .attr('y', d => yScale(result[d]))
    .attr('width', xScale.rangeBand()/2)
    .attr('height', d => chartHeight - yScale(result[d]))
    .attr('fill', 'steelblue');

  // Label the bars
  svg.selectAll('text')
    .data(Object.keys(result))
    .enter()
    .append('text')
    .text(d => d)
    .attr('x', d => xScale(d) + xScale.rangeBand() / 2)
    .attr('y', chartHeight + margin.bottom - 5)
    .attr('text-anchor', 'middle')
    .attr('font-size', '12px');

});
</script>

</body>
</html>